<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Basic -->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- Mobile Metas -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit-no" />
  <!-- Site Metas -->
  <meta name="keywords" content="SpotWise, Service Requests, Providers" />
  <meta name="description" content="Request or provide services through SpotWise." />
  <meta name="author" content="SpotWise" />

  <title>SpotWise - Service Hub</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />

  <!-- Font Awesome style -->
  <link href="css/font-awesome.min.css" rel="stylesheet" />

  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet" />
  
  <!-- Responsive style -->
  <link href="css/responsive.css" rel="stylesheet" />
  
  <!-- Service hub specific styles -->
  <style>
    .service-section {
      padding: 60px 0;
    }
    
    .role-container {
      min-height: 500px;
    }
    
    .request-card {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      padding: 20px;
      transition: transform 0.3s;
    }
    
    .request-card:hover {
      transform: translateY(-5px);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
      margin-bottom: 15px;
    }
    
    .category-badge {
      background-color: #7335b7;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 14px;
    }
    
    .status-badge {
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 12px;
    }
    
    .status-pending {
      background-color: #ffc107;
      color: #000;
    }
    
    .status-accepted {
      background-color: #17a2b8;
      color: white;
    }
    
    .status-in-progress {
      background-color: #007bff;
      color: white;
    }
    
    .status-completed {
      background-color: #28a745;
      color: white;
    }
    
    .status-cancelled {
      background-color: #dc3545;
      color: white;
    }
    
    .status-expired {
      background-color: #6c757d;
      color: white;
    }
    
    .request-actions {
      margin-top: 15px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    .btn-accept {
      background-color: #28a745;
      color: white;
    }
    
    .btn-complete {
      background-color: #007bff;
      color: white;
    }
    
    .seeker-form-container {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      padding: 25px;
    }
    
    .map-container {
      height: 300px;
      margin: 15px 0;
      border-radius: 10px;
      overflow: hidden;
    }
    
    .tab-container {
      margin-bottom: 30px;
    }
    
    .nav-tabs .nav-link.active {
      background-color: #7335b7;
      color: white;
      border-color: #7335b7;
    }
    
    .nav-tabs .nav-link {
      color: #333;
    }
    
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      border-radius: 10px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #7335b7;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    #emptyStateMessage {
      text-align: center;
      padding: 40px 0;
      color: #6c757d;
    }
    
    .pin-container {
      max-width: 320px;
      margin: 0 auto;
      text-align: center;
    }
    
    .pin-input {
      letter-spacing: 10px;
      font-size: 24px;
      text-align: center;
    }
    
    .location-display {
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 14px;
    }
    
    .timer {
      color: #dc3545;
      font-weight: bold;
    }
    
    .provider-tabs {
      margin-bottom: 20px;
    }
    
    .active-job-alert {
      background-color: #d1e7dd;
      color: #0f5132;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body class="sub_page">
  <div class="hero_area">
    <!-- Header section starts -->
    <header class="header_section">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container">
          <a class="navbar-brand" href="index.html">
            <span>SpotWise</span>
          </a>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span> </span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="about.html">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="service.html">Services</a>
              </li>
              <li class="nav-item active">
                <a class="nav-link" href="contact.html">Service Hub</a>
              </li>
            </ul>
            <div class="quote_btn-container">
              <!-- Login button - visible when user is not logged in -->
              <a href="login.html" class="quote_btn" id="loginBtn">
                Login
              </a>
              
              <!-- Profile dropdown - visible when user is logged in -->
              <div class="dropdown" id="profileDropdown" style="display: none;">
                <a class="dropdown-toggle profile-icon" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="fa fa-user-circle-o" aria-hidden="true"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
                  <a class="dropdown-item" href="profile.html"><i class="fa fa-user" aria-hidden="true"></i> My Profile</a>
                  <a class="dropdown-item" href="history.html"><i class="fa fa-history" aria-hidden="true"></i> History</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="#" id="logoutBtn"><i class="fa fa-sign-out" aria-hidden="true"></i> Logout</a>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <!-- End header section -->
  </div>

  <!-- Service Hub section -->
  <section class="service-section layout_padding">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="heading_container">
            <h2>Service Hub</h2>
            <p>Connect with local service providers or find service requests near you.</p>
          </div>
        </div>
      </div>
      
      <!-- Login required message (shown when not logged in) -->
      <div id="loginRequiredMessage" class="row" style="display: none;">
        <div class="col-md-8 mx-auto text-center">
          <div class="alert alert-info" role="alert">
            <h4 class="alert-heading">Please log in to continue!</h4>
            <p>You need to be logged in to create service requests or view available jobs.</p>
            <hr>
            <p class="mb-0">
              <a href="login.html" class="btn btn-primary">Login</a>
              <span class="mx-2">or</span>
              <a href="login.html" onclick="register()" class="btn btn-outline-primary">Register</a>
            </p>
          </div>
        </div>
      </div>
    
      <!-- Seeker Role UI -->
      <div id="seekerRole" class="role-container" style="display: none;">
        <div class="row">
          <div class="col-md-12">
            <div class="tab-container">
              <ul class="nav nav-tabs" id="seekerTabs" role="tablist">
                <li class="nav-item">
                  <a class="nav-link active" id="create-tab" data-toggle="tab" href="#create" role="tab">Create Request</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="active-tab" data-toggle="tab" href="#active" role="tab">Active Requests</a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="tab-content">
          <!-- Create Request Tab -->
          <div class="tab-pane fade show active" id="create" role="tabpanel">
            <div class="row">
              <div class="col-md-8 mx-auto">
                <div class="seeker-form-container position-relative">
                  <div id="createRequestLoading" class="loading-overlay" style="display: none;">
                    <div class="spinner"></div>
                  </div>
                  
                  <form id="serviceRequestForm">
                    <div class="form-group">
                      <label for="category">Service Category</label>
                      <select class="form-control" id="category" required>
                        <option value="">Select a service...</option>
                        <option value="Plumbing">Plumbing</option>
                        <option value="Electrical">Electrical</option>
                        <option value="Carpentry">Carpentry</option>
                        <option value="Cleaning">Cleaning</option>
                        <option value="Gardening">Gardening</option>
                        <option value="Painting">Painting</option>
                      </select>
                    </div>
                    
                    <div class="form-group">
                      <label for="description">Description</label>
                      <textarea class="form-control" id="description" rows="3" placeholder="Describe what you need help with..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                      <label for="contactNumber">Contact Number</label>
                      <input type="tel" class="form-control" id="contactNumber" pattern="[0-9]{10}" placeholder="10-digit number" required>
                    </div>
                    
                    <div class="form-group">
                      <label>Service Location</label>
                      <div id="locationMap" class="map-container"></div>
                      <div class="location-display" id="selectedLocationDisplay">
                        Using your current location
                      </div>
                      <button type="button" class="btn btn-sm btn-secondary mt-2" id="pickLocationBtn">
                        <i class="fa fa-map-marker"></i> Change Location
                      </button>
                    </div>
                    
                    <div class="form-group">
                      <label for="duration">How long is this request valid?</label>
                      <select class="form-control" id="duration" required>
                        <option value="30">30 minutes</option>
                        <option value="60" selected>1 hour</option>
                        <option value="120">2 hours</option>
                        <option value="180">3 hours</option>
                      </select>
                    </div>
                    
                    <div class="form-group">
                      <label for="additionalDetails">Additional Details (Optional)</label>
                      <textarea class="form-control" id="additionalDetails" rows="2" placeholder="Any additional information for the service provider..."></textarea>
                    </div>
                    
                    <div class="text-center">
                      <button type="submit" class="btn btn-primary" id="submitRequestBtn">Submit Request</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Active Requests Tab -->
          <div class="tab-pane fade" id="active" role="tabpanel">
            <div class="row">
              <div class="col-md-10 mx-auto">
                <div id="activeRequestsLoading" class="text-center" style="display: none;">
                  <div class="spinner d-inline-block"></div>
                  <p class="mt-2">Loading your active requests...</p>
                </div>
                
                <div id="activeRequestsContainer"></div>
                
                <div id="emptyActiveRequests" class="text-center" style="display: none;">
                  <p>You don't have any active service requests.</p>
                  <button class="btn btn-primary" onclick="$('#create-tab').tab('show')">Create a Request</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Provider Role UI -->
      <div id="providerRole" class="role-container" style="display: none;">
        <div class="row mb-4">
          <div class="col-md-12">
            <div id="providerStatusAlert" class="alert alert-warning">
              <strong>You are currently offline.</strong> Toggle your status to "Online" in your profile to see and accept service requests.
              <a href="profile.html" class="btn btn-sm btn-outline-primary ml-2">Go to Profile</a>
            </div>
            
            <div id="activeJobAlert" class="active-job-alert" style="display: none;">
              <h5>You have an active job in progress!</h5>
              <p>Complete your current job before accepting new requests.</p>
              <button class="btn btn-success" id="viewActiveJobBtn">View Active Job</button>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-12">
            <div class="provider-tabs">
              <ul class="nav nav-tabs" id="providerTabs" role="tablist">
                <li class="nav-item">
                  <a class="nav-link active" id="available-tab" data-toggle="tab" href="#available" role="tab">Available Requests</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="current-tab" data-toggle="tab" href="#current" role="tab">Current Job</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        
        <div class="tab-content">
          <!-- Available Requests Tab -->
          <div class="tab-pane fade show active" id="available" role="tabpanel">
            <div class="row">
              <div class="col-md-8">
                <div id="availableRequestsLoading" class="text-center mb-4" style="display: none;">
                  <div class="spinner d-inline-block"></div>
                  <p class="mt-2">Finding requests near you...</p>
                </div>
                
                <div id="availableRequestsContainer"></div>
                
                <div id="emptyAvailableRequests" class="text-center" style="display: none;">
                  <p>There are no service requests available in your area matching your skills.</p>
                  <button class="btn btn-primary" id="refreshRequestsBtn">
                    <i class="fa fa-refresh"></i> Refresh
                  </button>
                </div>
              </div>
              
              <div class="col-md-4">
                <div id="requestMapContainer" class="map-container" style="height: 400px;"></div>
                <div class="mt-2 text-center">
                  <small class="text-muted">Map shows service requests near your location</small>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Current Job Tab -->
          <div class="tab-pane fade" id="current" role="tabpanel">
            <div class="row">
              <div class="col-md-7">
                <div id="currentJobContainer">
                  <div id="noActiveJobMessage" class="text-center py-5">
                    <i class="fa fa-briefcase fa-3x text-muted mb-3"></i>
                    <h4>No Active Job</h4>
                    <p>You don't have any active jobs at the moment.</p>
                    <a href="#" onclick="$('#available-tab').tab('show')" class="btn btn-primary">Browse Available Requests</a>
                  </div>
                  
                  <div id="activeJobDetails" style="display: none;">
                    <!-- Active job details will be filled dynamically -->
                  </div>
                </div>
              </div>
              
              <div class="col-md-5">
                <div id="jobLocationMap" class="map-container" style="height: 300px;"></div>
                
                <div class="card mt-4">
                  <div class="card-header bg-primary text-white">
                    Complete Service
                  </div>
                  <div class="card-body">
                    <p>Once you've completed the service, ask the client for their verification PIN and enter it below:</p>
                    
                    <div class="pin-container">
                      <input type="text" id="verificationPin" class="form-control pin-input" maxlength="6" placeholder="######" autocomplete="off">
                      <button class="btn btn-success btn-block mt-3" id="completeJobBtn">
                        Verify & Complete
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- End service hub section -->

  <!-- Location Picker Modal -->
  <div class="modal fade" id="locationPickerModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Pick Service Location</h5>
          <button type="button" class="close" data-dismiss="modal">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="locationPickerMap" style="height: 400px;"></div>
          <div class="input-group mt-3">
            <input type="text" id="locationSearchInput" class="form-control" placeholder="Search for address...">
            <div class="input-group-append">
              <button class="btn btn-outline-secondary" type="button" id="searchLocationBtn">
                <i class="fa fa-search"></i>
              </button>
            </div>
          </div>
          <div class="location-permission-info alert alert-info mt-2" style="display: none;">
            <small><i class="fa fa-info-circle"></i> Allow location access in your browser for the best experience.</small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-primary" id="useMyLocationBtn" onclick="useCurrentLocation()">
            <i class="fa fa-location-arrow"></i> Use My Location
          </button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="confirmLocationBtn" onclick="confirmSelectedLocation()">Confirm Location</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Request Details Modal -->
  <div class="modal fade" id="requestDetailsModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Request Details</h5>
          <button type="button" class="close" data-dismiss="modal">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body" id="requestDetailsContent">
          <!-- Content will be dynamically populated -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="acceptRequestBtn">Accept Request</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer_container">
    <!-- Info section -->
    <section class="info_section">
      <div class="container">
        <div class="row">
          <div class="col-md-6 col-lg-3">
            <div class="info_detail">
              <h4>SpotWise</h4>
              <p>SpotWise connects you with local service providers. Contact us for all your service needs.</p>
            </div>
          </div>
          <div class="col-md-6 col-lg-2 mx-auto">
            <div class="info_link_box">
              <h4>Links</h4>
              <div class="info_links">
                <a href="index.html">Home</a>
                <a href="about.html">About</a>
                <a href="service.html">Services</a>
                <a href="contact.html">Service Hub</a>
              </div>
            </div>
          </div>
          <div class="col-md-6 col-lg-3">
            <h4>Subscribe</h4>
            <form action="#">
              <input type="text" placeholder="Enter email" />
              <button type="submit">Subscribe</button>
            </form>
          </div>
          <div class="col-md-6 col-lg-3 mb-0 ml-auto">
            <div class="info_contact">
              <h4>Contact Information</h4>
              <div class="contact_link_box">
                <a href="">
                  <i class="fa fa-map-marker" aria-hidden="true"></i>
                  <span>SpotWise HQ, San Francisco, CA</span>
                </a>
                <a href="tel:+01 123 456 7890">
                  <i class="fa fa-phone" aria-hidden="true"></i>
                  <span>Call +01 123 456 7890</span>
                </a>
                <a href="mailto:contact@spotwise.com">
                  <i class="fa fa-envelope" aria-hidden="true"></i>
                  <span>contact@spotwise.com</span>
                </a>
              </div>
            </div>
            <div class="info_social">
              <a href="https://www.facebook.com/SpotWise">
                <i class="fa fa-facebook" aria-hidden="true"></i>
              </a>
              <a href="https://twitter.com/SpotWise">
                <i class="fa fa-twitter" aria-hidden="true"></i>
              </a>
              <a href="https://www.linkedin.com/company/spotwise">
                <i class="fa fa-linkedin" aria-hidden="true"></i>
              </a>
              <a href="https://www.instagram.com/spotwise">
                <i class="fa fa-instagram" aria-hidden="true"></i>
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- End info section -->

    <!-- Footer section -->
    <footer class="footer_section">
      <div class="container">
        <p>
          &copy; <span id="displayYear"></span> All Rights Reserved by SpotWise.
        </p>
      </div>
    </footer>
    <!-- End footer section -->
  </div>

  <!-- jQuery -->
  <script src="js/jquery-3.4.1.min.js"></script>
  <!-- Popper JS -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
  </script>
  <!-- Bootstrap JS -->
  <script src="js/bootstrap.js"></script>
  <script src="js/custom.js"></script>
  <!-- Authentication script -->
  <script src="js/auth.js"></script>
  <!-- Helper scripts -->
  <script src="js/location-service.js"></script>
  <script src="js/map-service.js"></script>
  <!-- SweetAlert for better notifications -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Event Service for real-time updates - moved before service-hub.js -->
  <script src="js/event-service.js"></script>
  <!-- Service Hub Script -->
  <script src="js/service-hub.js"></script>

  <!-- Rest of scripts remain unchanged -->

  <script>
    // Add event listener for "Use My Location" button
    document.addEventListener('DOMContentLoaded', function() {
      const useMyLocationBtn = document.getElementById('useMyLocationBtn');
      if (useMyLocationBtn) {
        useMyLocationBtn.addEventListener('click', function() {
          if (window.locationService) {
            window.locationService.getCurrentLocation({ requestPermission: true })
              .then(position => {
                const latLng = new google.maps.LatLng(position.lat, position.lng);
                if (locationPickerMap) {
                  locationPickerMap.setCenter(latLng);
                  addLocationMarker(locationPickerMap, latLng);
                  
                  // Get address
                  window.locationService.getAddressFromCoordinates(latLng)
                    .then(result => {
                      const searchInput = document.getElementById('locationSearchInput');
                      if (searchInput && result && result.formatted_address) {
                        searchInput.value = result.formatted_address;
                      }
                    })
                    .catch(error => console.warn('Error getting address:', error));
                }
              })
              .catch(error => {
                console.warn('Error getting location:', error);
                document.querySelector('.location-permission-info').style.display = 'block';
              });
          }
        });
      }
      
      // Show location permission info if needed
      if (window.locationService && window.locationService.permissionDenied) {
        document.querySelector('.location-permission-info').style.display = 'block';
      }
    });
  </script>

  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh39n5U-4IoWpsVGUHWdqB6puEkhRLdmI&libraries=places&callback=initMapsCallback" async defer></script>
</body>

</html>
